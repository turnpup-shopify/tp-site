<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="styles.css">
	<title></title>
</head>
<body>
<div id="imgContainer-1">
	<img id="pixelate-me" src="image1.jpg" />
</div>
<div id="imgContainer-2">
	<img id="pixelate-me" src="image2.jpg" />
</div>
</body>

<script type="text/javascript">

	index=1;
	var elements = document.querySelectorAll("#pixelate-me").forEach((el) => {
			el.onload = function(){
				let c = document.createElement("canvas");
				let img1 = new Image();
				img1.src = document.getElementById("pixelate-me").src;
				document.getElementById("pixelate-me").remove();
				w = img1.width;
				h = img1.height;
				c.width = w;
				c.height = h;
				ctx = c.getContext("2d");
				ctx.drawImage(img1,0,0);
				let pixelArr = ctx.getImageData(0,0,w,h).data;
				let sample_size = 64;
				myLoop(w, h, sample_size, ctx, c, pixelArr, index);
				index += 1;
			}
		}
	)

	function myLoop(w, h, sample_size, ctx, c, pixelArr, index){
  	    setTimeout(() => {
	  	   	paint(w, h, sample_size, ctx, c, pixelArr, index);
	  	   	sample_size = sample_size/2;
	  	   	console.log("i: "+sample_size);
	  	   	if (sample_size > 1){
	  	   		myLoop(w, h, sample_size, ctx, c, pixelArr, index);
	  	   	}
		}, 1000);
  	}

	function paint(w, h, sample_size, ctx, c, pixelArr, index) {
		for(let y=0; y<h; y+=sample_size) {
			for(let x=0; x<w; x+=sample_size) {
				let p = (x+(y*w))*4;
				ctx.fillStyle = "rgba(" + pixelArr[p] + "," + pixelArr[p+1] + "," + pixelArr[p+2] + "," + 1 + ")";
				ctx.fillRect(x, y, sample_size, sample_size);
			}
		}
		let img2 = new Image();
		img2.src = c.toDataURL("image/jpeg");
		img2.width = 600;
		var tempID = "imgContainer-" + index;
		console.log(tempID);
		document.getElementById(tempID).innerHTML = "";
		document.getElementById(tempID).appendChild(img2);
	}
</script>

</html>